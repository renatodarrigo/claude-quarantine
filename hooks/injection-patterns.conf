# claude-guard — Shared Pattern Definitions
# Used by Layer 1 (hook) and Layer 3 (MCP proxy)
#
# Format: CATEGORY:SEVERITY:PATTERN
# CATEGORY: descriptive tag for reporting
# SEVERITY: HIGH, MED, LOW
# PATTERN: Extended regex (ERE) — applied case-insensitively
#
# Lines starting with # are comments. Blank lines are ignored.
#
# Design principle: Patterns should require sufficient context to avoid
# triggering on educational/documentation content that merely discusses
# prompt injection. Err on the side of specificity.

# --- System message impersonation ---
# Requires actual XML/markdown tag structure used to impersonate system messages
system_impersonation:HIGH:<system>[^<]{5,}|<\/system>|\[SYSTEM\][^a-z]{0,3}(IMPORTANT|ADMIN|UPDATE|NOTICE|DIRECTIVE|override|new)|\[INST\]|<<SYS>>|<\|im_start\|>system
system_impersonation:HIGH:\[IMPORTANT SYSTEM (MESSAGE|NOTICE|UPDATE)\]
system_impersonation:MED:IMPORTANT:.*ignore previous|new instructions:|updated instructions:

# --- Role injection ---
# "you are now" requires directive context (not documentation saying "you are now able to")
role_injection:HIGH:you are now (a |an )?(compliant|helpful|unrestricted|unfiltered|different|new|my)|your new role is|forget (all )?(your |prior )?instructions
role_injection:HIGH:your instructions have (been )?(changed|updated|modified|replaced)
role_injection:MED:from now on,? you (will|should|must|shall) (obey|comply|follow|execute|do)
role_injection:MED:pretend (you are|to be|that you)

# --- Instruction override ---
# "ignore previous instructions" is the classic injection phrase
instruction_override:HIGH:ignore (all )?(previous|prior|above|earlier|other) (instructions|prompts|rules|directives|guidelines)
instruction_override:HIGH:disregard (all )?(above|previous|prior|earlier|other) (instructions|prompts|rules|safety|directives|guidelines)
instruction_override:HIGH:ADMIN MODE (activated|enabled|on)|developer mode (activated|enabled|on)|sudo mode|god mode|jailbreak (mode|enabled|activated)
instruction_override:MED:do not follow (your|the|any) (previous|original|prior)
instruction_override:MED:stop following (your|the) (instructions|rules|guidelines)
instruction_override:MED:cancel (all )?(previous|prior) (instructions|directives)

# --- Tool manipulation ---
# Directives aimed at making an AI use tools
tool_manipulation:HIGH:use the Bash tool|use the Write tool|use the Edit tool|use the Read tool
tool_manipulation:HIGH:run the following command|execute this (script|command|code)
tool_manipulation:HIGH:create a file (called|named|at)|write (this |the following )?to (the )?file
tool_manipulation:MED:call the [a-zA-Z_]+ tool|invoke the [a-zA-Z_]+ tool
tool_manipulation:MED:modify the file|append to (the )?file

# --- Credential exfiltration ---
credential_exfil:HIGH:send .{0,30} to https?://|curl .{0,50}(api.key|token|secret|password|credential)
credential_exfil:HIGH:exfiltrate|POST .{0,30}(credentials|secrets|tokens|keys)
credential_exfil:HIGH:pipe .{0,30} to .{0,30}(url|webhook|endpoint|server)
credential_exfil:MED:fetch .{0,30}webhook|forward .{0,30} to .{0,30}(http|url)

# --- Hidden directives (Unicode) ---
# Zero-width characters and RTL overrides that hide text
unicode_obfuscation:HIGH:\xe2\x80\x8b|\xe2\x80\x8c|\xe2\x80\x8d|\xef\xbb\xbf|\xe2\x81\xa0
unicode_obfuscation:HIGH:\xe2\x80\xae|\xe2\x80\xad|\xe2\x81\xa6|\xe2\x81\xa9

# --- Encoded payloads ---
# Base64-encoded common injection phrases
encoded_payload:MED:aWdub3JlI(GFsbCBwcmV2aW91cy|HByZXZpb3Vz)
encoded_payload:MED:WW91IGFyZSBub3c=|Rm9yZ2V0IHlvdXI=

# --- Social engineering ---
# Fake urgency/authority claims directed at an AI
social_engineering:MED:this is (an )?(urgent|critical|emergency|important) (security )?(update|message|notice|alert)
social_engineering:MED:(the|your) (developers?|creators?|makers?|team) (want|need|require|asked) you to
social_engineering:MED:you have been (compromised|hacked|breached)|security (breach|incident) detected
