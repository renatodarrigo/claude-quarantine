# ============================================================
# claude-guard — Configuration
# https://github.com/renatodarrigo/claude-guard
#
# Organization: settings grouped by layer.
# If a layer is disabled, its settings are ignored at runtime.
#
# Annotation format for each config key:
#   @name    — human-readable display name (used by /guard-config)
#   @desc    — description of the setting (used by /guard-config)
#   @type    — boolean, string, number, path, csv, select
#   @options — valid values for select type (comma-separated)
#
# When adding new settings, always include annotations.
# ============================================================

# ==================== Guard Mode ====================

# @name Guard Mode
# @desc Controls enforcement behavior. "enforce" blocks HIGH threats. "audit" logs only, never blocks.
# @type select
# @options enforce,audit
GUARD_MODE=enforce

# ==================== Layer Toggles ====================
# Enable/disable each layer. Disabled layers skip all processing.

# @name Layer 0 — URL Blocklist
# @desc Pre-tool-use URL blocklist check (~10ms latency)
# @type boolean
ENABLE_LAYER0=true

# @name Layer 1 — Pattern Scanner
# @desc Regex-based pattern matching on tool results (~50-200ms latency)
# @type boolean
ENABLE_LAYER1=true

# @name Layer 2 — LLM Analysis
# @desc Secondary LLM analysis for subtle attacks (~2-5s latency). Only runs when Layer 1 didn't find HIGH.
# @type boolean
ENABLE_LAYER2=false

# @name Layer 3 — MCP Proxy
# @desc Content sanitization via MCP proxy tools (redact/annotate/quarantine)
# @type boolean
ENABLE_LAYER3=true

# @name Layer 4 — Rate Limiting
# @desc Exponential backoff for sources that repeatedly send malicious input
# @type boolean
ENABLE_LAYER4=true

# @name File Content Scanning
# @desc Scan Read/Grep tool results for prompt injection. Requires Read|Grep in PostToolUse hook matcher.
# @type boolean
ENABLE_FILE_SCANNING=true

# ==================== Layer 0: URL Blocklist ====================

# @name Blocklist File
# @desc Local file with blocked URL patterns (one per line)
# @type path
BLOCKLIST_FILE=~/.claude/hooks/blocklist.conf

# @name Remote Blocklist URL
# @desc URL to fetch additional blocklist entries from (cached locally). Leave empty to disable.
# @type string
BLOCKLIST_REMOTE_URL=

# @name Remote Blocklist Cache TTL
# @desc How long to cache the remote blocklist before re-fetching (seconds)
# @type number
BLOCKLIST_REMOTE_CACHE_TTL=86400

# ==================== Layer 1: Pattern Scanner ====================

# @name Pattern Scan Timeout
# @desc Maximum time for pattern scanning per tool call (seconds)
# @type number
LAYER1_TIMEOUT=5

# @name HIGH Threat Action
# @desc What to do when a HIGH severity threat is detected
# @type select
# @options block,warn
HIGH_THREAT_ACTION=block

# Per-category action overrides: ACTION_<category>=block|warn|silent
# Overrides HIGH_THREAT_ACTION for specific categories.
# Examples:
# ACTION_social_engineering=warn
# ACTION_credential_exfil=block
# ACTION_encoded_payload=silent

# @name Pattern Files
# @desc Colon-separated list of pattern definition files
# @type string
GUARD_PATTERNS=~/.claude/hooks/injection-patterns.conf

# @name Pattern Severity Overrides
# @desc File with per-pattern severity overrides
# @type path
PATTERN_OVERRIDES_FILE=~/.claude/hooks/pattern-overrides.conf

# @name URL Allowlist File
# @desc URLs matching these patterns skip scanning entirely
# @type path
ALLOWLIST_FILE=~/.claude/hooks/allowlist.conf

# @name Scan Cache
# @desc Cache scan results to avoid re-scanning identical content
# @type boolean
ENABLE_SCAN_CACHE=true

# @name Scan Cache TTL
# @desc How long cached scan results are valid (seconds)
# @type number
SCAN_CACHE_TTL=300

# @name Scan Cache File
# @desc Path to the scan cache state file
# @type path
SCAN_CACHE_FILE=~/.claude/hooks/scan-cache.json

# @name Session Buffer
# @desc Track recent tool outputs to detect split-payload attacks
# @type boolean
ENABLE_SESSION_BUFFER=true

# @name Session Buffer Size
# @desc Number of recent tool outputs to keep in the buffer
# @type number
SESSION_BUFFER_SIZE=5

# @name Session Buffer TTL
# @desc How long buffer entries stay valid (seconds)
# @type number
SESSION_BUFFER_TTL=60

# @name Session Buffer File
# @desc Path to the session buffer state file
# @type path
SESSION_BUFFER_FILE=~/.claude/hooks/session-buffer.json

# ==================== Layer 2: LLM Analysis ====================

# @name LLM Model
# @desc Model for Layer 2 analysis (empty = system default)
# @type string
LAYER2_MODEL=

# @name LLM Timeout
# @desc Maximum time to wait for LLM response (seconds)
# @type number
LAYER2_TIMEOUT=15

# @name LLM Max Content Length
# @desc Truncate content to this length before sending to LLM
# @type number
LAYER2_MAX_CHARS=10000

# ==================== Layer 3: MCP Proxy ====================

# @name HIGH Severity Sanitization
# @desc How to sanitize HIGH-severity content in MCP proxy
# @type select
# @options redact,annotate,quarantine,passthrough
SANITIZE_HIGH=redact

# @name MED Severity Sanitization
# @desc How to sanitize MEDIUM-severity content in MCP proxy
# @type select
# @options redact,annotate,quarantine,passthrough
SANITIZE_MED=annotate

# @name Quarantine Directory
# @desc Directory to store quarantined content
# @type path
QUARANTINE_DIR=~/.claude/hooks/quarantine

# ==================== Layer 4: Rate Limiting ====================

# @name Rate Limit Timeout
# @desc Timeout for rate limit state operations (seconds)
# @type number
LAYER4_TIMEOUT=5

# @name Rate Limit State File
# @desc Path to the rate limit state file
# @type path
RATE_LIMIT_STATE_FILE=~/.claude/hooks/rate-limit-state.json

# @name Base Block Duration
# @desc Initial block duration after first violation (seconds)
# @type number
RATE_LIMIT_BASE_TIMEOUT=30

# @name Backoff Multiplier
# @desc Each subsequent violation multiplies the block duration by this factor
# @type number
RATE_LIMIT_MULTIPLIER=1.5

# @name Max Block Duration
# @desc Maximum block duration cap (seconds). Default: 12 hours.
# @type number
RATE_LIMIT_MAX_TIMEOUT=43200

# @name Clean Decay Period
# @desc How long without violations before backoff level decays (seconds)
# @type number
RATE_LIMIT_DECAY_PERIOD=3600

# @name Rate-Limit HIGH Threats
# @desc Whether HIGH severity threats trigger rate limiting
# @type boolean
RATE_LIMIT_SEVERITY_HIGH=true

# @name Rate-Limit MED Threats
# @desc Whether MEDIUM severity threats trigger rate limiting
# @type boolean
RATE_LIMIT_SEVERITY_MED=true

# @name Rate-Limit LOW Threats
# @desc Whether LOW severity threats trigger rate limiting
# @type boolean
RATE_LIMIT_SEVERITY_LOW=false

# @name Persist Rate Limit State
# @desc Keep rate limit blocks across restarts
# @type boolean
RATE_LIMIT_PERSIST=true

# ==================== File Content Scanning ====================

# @name Lightweight Pattern File
# @desc Pattern file for trusted directory scanning (low false-positive subset)
# @type path
FILE_PATTERNS_FILE=~/.claude/hooks/file-patterns.conf

# @name Sensitive Files
# @desc Comma-separated basenames that always get full scanning (even in trusted dirs)
# @type csv
SENSITIVE_FILES=.cursorrules,CLAUDE.md,.env

# @name Trusted Directories
# @desc Comma-separated paths. Files here get lightweight scanning. Everything else gets full scanning.
# @type csv
TRUSTED_DIRS=

# @name Prompted Dirs State File
# @desc Tracks directories the agent has already prompted about
# @type path
PROMPTED_DIRS_FILE=~/.claude/hooks/prompted-dirs.json

# ==================== Logging ====================

# @name Log File
# @desc Path to the JSONL detection log
# @type path
LOG_FILE=~/.claude/hooks/injection-guard.log

# @name Log Threshold
# @desc Minimum severity to log
# @type select
# @options LOW,MED,HIGH
LOG_THRESHOLD=MED

# @name Max Log Size
# @desc Max log file size before rotation (K/M/G suffixes)
# @type string
LOG_MAX_SIZE=10M

# @name Max Log Entries
# @desc Max number of log entries before rotation
# @type number
LOG_MAX_ENTRIES=10000

# @name Rotated Files to Keep
# @desc Number of rotated log files to keep
# @type number
LOG_ROTATE_COUNT=3
